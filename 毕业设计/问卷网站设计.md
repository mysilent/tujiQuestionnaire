# 数据库设计

### 1.网站数据库设计

- 调查问卷主表

```sql
CREATE TABLE `survey_info` (
  `id` varchar(255) NOT NULL AUTO_INCREMENT,
  `survey_name` varchar(255) CHARACTER SET utf8 NOT NULL COMMENT '主题',
  `survey_description` varchar(1000) CHARACTER SET utf8 DEFAULT NULL COMMENT '描述',
  `start_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP  COMMENT '开始时间',
  `end_time` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '结束时间',
  `status` char(1) CHARACTER SET utf8 NOT NULL DEFAULT '0' COMMENT '0 发布 1 暂存 2已结束 3已失效',
  `survey_sort` int(11) NOT NULL DEFAULT '0' COMMENT '排序',
  `top_flag` char(1) CHARACTER SET utf8 NOT NULL DEFAULT '1' COMMENT '0 置顶 1不置顶',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
  `creator_id` varchar(255) NOT NULL COMMENT '创建人员ID',
  `updator_id` varchar(255) NOT NULL COMMENT '更新人员ID',
  `survey_pic_id` int(11) DEFAULT NULL COMMENT '图片id',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=113 DEFAULT CHARSET=utf8mb4 COMMENT='调查问卷主表';

```

**问题主表，关联问卷主键ID**

- 问题主表	

```sql
CREATE TABLE `question_info` (
  `id`varchar(255) NOT NULL AUTO_INCREMENT,
  `survey_id` bigint NOT NULL COMMENT '关联调查问卷主表ID',
  `question_type` char(1) CHARACTER SET utf8 NOT NULL DEFAULT '1' COMMENT '1 单选 2多选 3填空',
  `question_description` varchar(1000) CHARACTER SET utf8 DEFAULT NULL COMMENT '问题描述',
  `question_sort` int(11) DEFAULT '0' COMMENT '问题排序',
  `required_flag` char(1) CHARACTER SET utf8 DEFAULT '0' COMMENT ' 0 必填 1非必填',
  `question_pic_id` int(11) DEFAULT NULL COMMENT '图片id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=212 DEFAULT CHARSET=utf8mb4 COMMENT='调查问卷问题主表';

```

- 选项主表

```sql
CREATE TABLE `option_info` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `survey_id` varchar(255) NOT NULL COMMENT '调查问卷ID',
  `question_id` varchar(255) NOT NULL COMMENT '问题ID',
  `option_name` varchar(255) CHARACTER SET utf8 NOT NULL COMMENT '选项名称',
  `option_sort` int(11) NOT NULL COMMENT '选项排序',
  `option_pic_id` int(11) DEFAULT NULL COMMENT '图片id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=518 DEFAULT CHARSET=utf8mb4 COMMENT='调查问卷问题选项主表';

```

问题类型是填空的不需要往选项表里插入内容

有了问卷之后，我们就需要填写问卷，因此我们还需要一份调查问卷的答案表

- 答案主表

```sql
CREATE TABLE `answer_info` (
  `id` varchar(255) NOT NULL AUTO_INCREMENT,
  `user_id` varchar(255) CHARACTER SET utf8 NOT NULL COMMENT '成员id',
  `survey_id` varchar(255) NOT NULL COMMENT '问卷主表ID',
  `question_id` varchar(255) NOT NULL COMMENT '问题主表ID',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=140 DEFAULT CHARSET=utf8mb4 COMMENT='用户答案表';

```

- 答案子表

```sql
CREATE TABLE `answer_son_info` (
  `id` varchar(255) NOT NULL AUTO_INCREMENT,
  `answer_id` varchar(255) NOT NULL COMMENT '答案主表id',
  `option_id` varchar(255) DEFAULT NULL COMMENT '选项主表id',
  `option_content` varchar(255) CHARACTER SET utf8 DEFAULT NULL COMMENT '答案内容',
  `answer_pic_id` int(11) DEFAULT NULL COMMENT '图片id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=207 DEFAULT CHARSET=utf8mb4 COMMENT='用户答案子表';

```

其实两张表可以合并为一张表。问题类型为填空时，答案也不仅限为问题描述，也可能是一张图，这里也可以直接放图片的链接地址，避免再关联去查图片的链接；

- 用户表

```sql
CREATE TABLE `user` (
   `id` varchar(255) NOT NULL AUTO_INCREMENT,
   `username` varchar(255) NOT NULL  COMMENT '用户名',
   `password` varchar(255) NOT NULL DEFAULT '123456' COMMENT '密码',
   `nickname` varchar(255) DEFAULT '你好新用户' COMMENT '昵称',
   `email` varchar(255) DEFAULT NULL COMMENT '邮箱',
   `phone` varbinary(255) DEFAULT NULL COMMENT '电话',
   `create_date` timestamp NULL DEFAULT CURRENT_TIMESTAMP NULL COMMENT '创建日期',
   `update_date` timestamp NULL DEFAULT NULL COMMENT '更新时间',
   `state` int DEFAULT '1' COMMENT '启用1 封禁0 注销2',
   PRIMARY KEY (`id`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表'
```



- 用户作答问卷信息

```sql
CREATE TABLE `user_create_answer` (
   `id` varchar(255) NOT NULL AUTO_INCREMENT,
   `username` varchar(255) NOT NULL COMMENT '用户名',
   `survey_id` varchar(255) NOT NULL COMMENT '问卷主表id',
   `answer_id` varchar(255) NOT NULL COMMENT '答案主表id',
   `create_date` timestamp NULL DEFAULT CURRENT_TIMESTAMP NULL COMMENT '创建时间',
   PRIMARY KEY (`id`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户作答问卷信息'
```





### 2.网站对象属性统一设计

#### 	2.1.survey_info 调查            问卷主表

| 字段名             | 名称                          | 备注     |
| ------------------ | ----------------------------- | -------- |
| id                 | 唯一主键                      |          |
| survey_name        | 主题                          | 问卷名称 |
| survey_description | 描述                          |          |
| start_time         | 开始时间                      |          |
| end_time           | 结束时间                      |          |
| status             | 0 发布 1 暂存 2已结束 3已失效 |          |
| survey_sort        | 排序                          |          |
| top_flag           | 0 置顶 1不置顶                |          |
| create_date        | 创建时间                      |          |
| update_date        | 更新时间                      |          |
| creator_id         | 创建人员id                    |          |
| updator_id         | 更新人员id                    |          |
| survey_pic_id      | 图片id                        |          |

#### 	2.2question_info调查问卷         问题主表

| 字段名               | 名称               | 备注         |
| -------------------- | ------------------ | ------------ |
| id                   | 唯一主键           |              |
| survey_id            | 关联调查问卷主表id | 获取那个问卷 |
| question_type        | 1 单选 2多选 3填空 |              |
| question_description | 问题描述           |              |
| question_sort        | 问题排序           |              |
| required_flag        | 0 必填 1非必填     |              |
| question_pic_id      | 图片id             |              |

#### 	2.3 option_info调查问卷问题      选项主表

| 字段名        | 名称               | 备注         |
| ------------- | ------------------ | ------------ |
| id            | 唯一主键           |              |
| survey_id     | 关联问卷调查主表id | 获取那个问卷 |
| question_id   | 关联问卷问题id     | 获取那个题   |
| option_name   | 选项名称           |              |
| option_sort   | 选项排序           |              |
| option_pic_id | 图片id             |              |

#### 2.4 answer_info用户       答案主表

| 字段名      | 名称       | 备注             |
| ----------- | ---------- | ---------------- |
| id          | 唯一标识   |                  |
| user_id     | 成员id     |                  |
| survey_id   | 问卷主表id | 获取填写那个问卷 |
| question_id | 问题主表id | 获取那个题       |
| create_date | 创建时间   |                  |

#### 2.5 answer_son_info用户      答案子表

| 字段名         | 名称       | 备注             |
| -------------- | ---------- | ---------------- |
| id             | 唯一标识   |                  |
| answer_id      | 答案主表id | 获取谁填写       |
| option_id      | 选项主表id | 填写选项去哪里找 |
| option_content | 答案内容   | 答案             |
| answer_pic_id  | 图片id     |                  |

#### 2.6user用户表

| 字段名      | 名称              | 备注                 |
| ----------- | ----------------- | -------------------- |
| id          | 唯一标识          |                      |
| username    | 用户名            |                      |
| password    | 密码              | 默认值（123456）     |
| nickname    | 昵称              | 默认值（你好新用户） |
| email       | 邮箱              |                      |
| phone       | 电话              |                      |
| create_date | 创建日期          |                      |
| update_date | 更新时间          |                      |
| state       | 启用1 封禁0 注销2 | 状态                 |

​	2.7 user_create_answer 用户答卷记录表

| 字段名      | 名称       | 备注 |
| ----------- | ---------- | ---- |
| id          | 唯一标识   |      |
| user_id     | 用户id     |      |
| survey_id   | 问卷主表id |      |
| answer_id   | 答案主表id |      |
| create_date | 创建时间   |      |

实体类

1. User  用户
2. UserCreateAnswer 用户答卷表
3. Answer 用户答案主表
4. AnswerSon 用户答案子表
5. Option  问卷问题选项主表
6. Question 问卷问题主表
7. Survey 问卷主表















### 3.网站接口service

```java
/**
     * 提交填写好的问卷至问题表
     * @param answerDto AnswerDto 对象
     * @return 返回定义的统一返回类
     */
    Result submitAnswer(AnswerDto answerDto);




 /**
     * 将前端传入的问卷信息分别存入问卷表、问题表、选项表
     * @param surveyCreateDto  surveyCreateDto实体类
     * @return 返回定义的统一返回类
     */
    Result createQuestionnaire(SurveyCreateDto surveyCreateDto);

    Result createQuestionnaire1(SurveyCreateDto surveyCreateDto);

    /**
     * 根据前端传过来的问卷id返回问卷所有信息
     * @param id 传过来的问卷id
     * @return 返回存储问卷所有信息的一个实体类
     */
    SurveyCreateDto selectQuestionnaire(Long id);




    /**
     * 查找该用户的填写记录
     * @param userId 用户id
     * @return UserCreateAnswer  list列表对象
     */
    List<UserCreateAnswer> createAnswerHistory(Long userId);




/**
     * 登录
     * @param username 账户
     * @param password 密码
     * @return 失败或成功
     */
     Integer login(String username, String password);

    /**
     * 注册
     * @param username 账户
     * @param password 密码
     * @return 失败或成功
     *
     */
     Integer enroll(String username,String password);

    /**
     * 登录之后将用户一部分信息存入UserDto对象中，以便后面用户进行各种功能的使用
     * @param username 用户名
     * @return 返回UserDto对象
     */
    UserDto selectUser(String username);
```

### 4.网站接口Mapper



